## Context

Sentinel currently lacks a standardized release pipeline for binary and container artifacts. The requested outcome is to release Go binaries with GoReleaser in GitHub Actions, publish Docker images to GHCR via a separate GitHub Actions workflow, and keep image publishing out of GoReleaser.

## Goals / Non-Goals

**Goals:**
- Add deterministic binary release artifacts generated by GoReleaser.
- Add deterministic Docker image publishing to GHCR via GitHub Actions.
- Enforce separation of responsibilities: GoReleaser handles binaries/releases, Docker workflow handles images.
- Document the release process in the docs site.

**Non-Goals:**
- Publishing images via GoReleaser.
- Supporting non-GitHub registries in the initial change.
- Reworking application runtime behavior or config model.

## Decisions

### 1) Add `.goreleaser.yaml` as binary-only release configuration
- Configure build matrix, archives, and checksums for Sentinel binary releases.
- Exclude Docker image stanzas from GoReleaser config.

Alternatives considered:
- Use plain `go build` in workflow instead of GoReleaser: rejected because it duplicates packaging/versioning logic and reduces release consistency.

### 2) Use separate GitHub workflow for GoReleaser release execution
- Add a release workflow triggered by semver tag pushes.
- Grant `contents: write` for release asset publishing.
- Run GoReleaser in release mode and attach artifacts to GitHub Releases.

Alternatives considered:
- Triggering only on manual dispatch: rejected because tag-driven releases are expected as the primary path.

### 3) Use separate GitHub workflow for Docker build/push to GHCR
- Add Docker workflow triggered by semver tags.
- Use `docker/setup-buildx-action`, `docker/metadata-action`, and `docker/build-push-action`.
- Push to `ghcr.io/<owner>/<repo>` with version tags and OCI labels.
- Grant `packages: write` and `contents: read` permissions.

Alternatives considered:
- Single workflow combining binaries and container publishing: rejected to keep failure domains and permissions narrower.

### 4) Update docs to reflect release artifact responsibilities
- Document that GoReleaser publishes binaries and the Docker workflow publishes images.
- Include operator-facing commands/trigger expectations and artifact locations.

Alternatives considered:
- Leaving workflow behavior undocumented: rejected because release operations become opaque.

## Risks / Trade-offs

- **[Risk] Tag-triggered workflows can publish unintended releases** -> **Mitigation:** scope triggers to semantic version tags and document release process.
- **[Risk] Registry auth/permissions failures for GHCR** -> **Mitigation:** explicit workflow permissions and use of `GITHUB_TOKEN` with package write access.
- **[Risk] Divergence between binary and image versions** -> **Mitigation:** drive both workflows from the same tag pattern and metadata conventions.

## Migration Plan

1. Add `.goreleaser.yaml` with binary-only configuration.
2. Add/update GitHub Actions release workflow for GoReleaser.
3. Add/update GitHub Actions Docker workflow for GHCR publishing.
4. Update docs with release artifact flow and troubleshooting notes.
5. Validate using a prerelease tag in a test repository context.

Rollback:
- Disable or revert new workflows and `.goreleaser.yaml`.
- Remove release docs updates if workflow strategy changes.

## Open Questions

- Should Docker workflow also publish `latest` on stable tags only or on all semver tags?
- Should release workflow enforce changelog generation or rely on existing notes process?
- Do we want signed artifacts/image attestations in this initial iteration?
